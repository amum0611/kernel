<!--
  ~ Copyright 2005-2007 WSO2, Inc. (http://wso2.com)
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <body>
        <p>WSO2 Carbon Data Sources [<a href="docs_index.html">Documentation Index</a>]
        </p>

        <h1>WSO2 Carbon Data Sources</h1>
        <p>This guide describes how WSO2 Carbon Data Sources can be used, configured and its 
	   improvements over the previous Data Source implementation. WSO2Carbon 4.0.0 
	   is shipped with WSO2 Carbon Data Source implementation which can be used to create 
	   global and local data sources. 
        </p>

        <h2>Contents</h2>
        <p></p>

        <ul>
            <li>
                <a href="#introductiontocarboncoreds">Introduction to WSO2 Carbon Data Sources</a>
            </li>
            <li>
                <a href="#improvements">Improvements of Carbon Data Sources over older Data Source implementation</a>
            </li>
	     <li>
                <a href="#config">Carbon Data Source Configuration</a>
            </li>
	     <li>
                <a href="#usingcarboncoreds">Using Carbon Data Source Implementation</a>
            </li>
            <ul>
                <li>
                    <a href="#localds">Creating Local Data sources</a>
                </li>
                <li>
                    <a href="#globalds">Creating Gloabal Data Sources</a>
                </li>
            </ul>
         </ul>

        <h2 id="introductiontocarboncoreds">Introduction to WSO2 Carbon Data Sources</h2>
        <p>WSO2 Carbon Core is added with new Data Source implementation support. This functionality 
	is to be used by registry / user manager in looking up data sources using JNDI. 
	Therefore it has been added to Carbon Core.  
        </p>
        
        <h2 id="improvements">Improvements of Carbon Data Source over older Data Source implementation</h2>
            <ul>
                <li>
                    <p>The connection pooling implementation has been changed to jdbc-pool, from DBCP. All of jdbc-pool properties are supported.</p>
                </li>
                <li>
                    <p>Carbon Secure Vault support.</p>
                </li>
		<li>
                    <p>Database provider given DataSource support, i.e. that implements javax.sql.DataSource, javax.sql.XADataSource. 
		For example if someone need to use Oracle supplied poolable DataSource implementation, it is possible to do so, 
		and also required for creating data sources to be used in distributed transactions.</p>
                </li>
		<li>
                    <p>Automatic sync of data sources in a clustered environment using the coordination component.</p>
                </li>
		<li>
                    <p>Pluggable data source types, so other than RDBMS data sources can be registered using this (for in-memory, JNDI access).</p>
                </li>
            </ul>
	<h2 id="config">Carbon Data Source Configuration</h2>
        <p>
         Data Sources are defined inside a separate directory at /repository/conf/datasources/.
	 Inside this directory there is a single file 'master-datasources.xml' that is 
	 coming from Carbon Core. It contains the data source definition for 
	 registry/user-manager database. A single file can contain multiple data sources. 
	 If more data sources need to be added, a new file with the pattern *-datasources.xml
	 can be created and it will be loaded. This was done for easy addition of data sources.
	 For example, bps-datasources.xml can be maintained seperately without maintaining one 
	 global datasource file. This means it has to maintain data sources used in Carbon Core in their product.   
        </p>
        <h2 id="usingcarboncoreds">Using Carbon Data Source Implementation</h2>
        <p>
         Carbon Data Source Implementation can be used in two ways.   
        </p>
        <h2 id="localds">1. Creating Local Data sources</h2>
        <p>
         Carbon Data Sources provide an API for creating DataSource objects to 
	create connections. This will be creating your own data sources locally 
	in your app, without registering it in a global way. For that we need to 
	simply use the "org.wso2.carbon.ndatasource.rdbms.RDBMSDataSource", where 
	we can give it the properties like connection URL, User, Password, etc and 
	create the connections.    
        </p>
        <h2 id="globalds">2. Creating Gloabal Data Sources</h2>

        <p>
	In this case Data Sources are registered globally, using the *-datasources.xml
	files in the file system or in the registry by using the UI. In this way, you 
	can do a JNDI lookup or use the OSGi service that is provided to do an in-memory
	lookup to get the data sources. The advantage of this is, the connection pools are
	centrally handled. Also this provide automatic sync of data sources within a 
	cluster, where if you update/delete a data source in one node it will be 
	reflected by all the nodes in the cluster. 
        </p>

    </body>
</html>
